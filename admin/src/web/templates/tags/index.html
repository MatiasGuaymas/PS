{% extends "layout.html" %}

{% block content %}
<h2>Listado de Tags</h2>

<form method="get" class="mb-3">
  <div class="row">
    <div class="col-md-4">
      <label for="search" class="form-label">Buscar por nombre:</label>
      <input type="text" class="form-control" id="search" name="search" 
             placeholder="Escriba el nombre del tag..." value="{{ search }}">
    </div>
    <div class="col-md-3">
      <label for="order" class="form-label">Ordenar por:</label>
      <select class="form-control" id="order" name="order">
        <option value="name" {% if order == "name" %}selected{% endif %}>Nombre</option>
        <option value="created_at" {% if order == "created_at" %}selected{% endif %}>Fecha de creación</option>
      </select>
    </div>
    <div class="col-md-3">
      <label for="direction" class="form-label">Dirección:</label>
      <select class="form-control" id="direction" name="direction">
        <option value="asc" {% if direction == "asc" %}selected{% endif %}>Ascendente (A-Z)</option>
        <option value="desc" {% if direction == "desc" %}selected{% endif %}>Descendente (Z-A)</option>
      </select>
    </div>
    <div class="col-md-2 d-flex align-items-end">
      <button type="submit" class="btn btn-primary me-2">Buscar</button>
      <a href="{{ url_for('tags.index') }}" class="btn btn-secondary me-2">Limpiar</a>
    </div>
  </div>
</form>

<div class="mb-3">
  <a href="{{ url_for('tags.create') }}" class="btn btn-success">Nuevo Tag</a>
</div>

{% if tags.items %}
<table class="table">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Slug</th>
      <th>Fecha de creación</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for tag in tags.items %}
    <tr>
      <td><a href="{{ url_for('tags.detail', tag_id=tag.id) }}">{{ tag.name }}</a></td>
      <td>{{ tag.slug }}</td>
      <td>{{ tag.created_at.strftime('%d/%m/%Y') }}</td>
      <td>
        <a href="{{ url_for('tags.edit', tag_id=tag.id) }}" class="btn btn-warning btn-sm">Editar</a>
        <form method="POST" action="{{ url_for('tags.delete', tag_id=tag.id) }}" style="display:inline;">
          <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="alert alert-info text-center" role="alert">
  {% if search %}
    <h5>No se encontraron tags</h5>
    <p>No hay tags que coincidan con la búsqueda "<strong>{{ search }}</strong>"</p>
  {% else %}
    <h5>No hay tags registrados</h5>
    <p>Aún no se han creado tags en el sistema.</p>
    <a href="{{ url_for('tags.create') }}" class="btn btn-success">Crear primer tag</a>
  {% endif %}
</div>
{% endif %}

{% if tags.items and (tags.has_prev or tags.has_next) %}
<nav>
  <ul class="pagination">
    {% if tags.has_prev %}
      <li class="page-item"><a class="page-link" href="{{ url_for('tags.index', page=tags.prev_num, search=search, order=order, direction=direction) }}">Anterior</a></li>
    {% endif %}
    <li class="page-item active"><span class="page-link">{{ tags.page }}</span></li>
    {% if tags.has_next %}
      <li class="page-item"><a class="page-link" href="{{ url_for('tags.index', page=tags.next_num, search=search, order=order, direction=direction) }}">Siguiente</a></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}